{% if enhancedEcommerce.addToCartFormId is not empty %}
document.addEventListener("DOMContentLoaded", function(event) {
    var form = document.getElementById('{{ enhancedEcommerce.addToCartFormId }}');

    if (typeof(form) != 'undefined' && form != null) {
        document.querySelector("#{{ enhancedEcommerce.addToCartFormId }}").addEventListener("submit", (event) => {
            event.preventDefault();

            var datalayer = {
                'event': '{{ enhancedEcommerce.event }}',
                'eventCategory': '{{ enhancedEcommerce.eventCategory }}',
                'eventAction': '{{ enhancedEcommerce.eventAction }}',
                'eventLabel': '{{ enhancedEcommerce.eventLabel }}',
                'ecommerce': {
                    'add': {
                        'products': [
                            {% for product in enhancedEcommerce.ecommerce.add.products %}
                            {
                                'id': '{{ product.id }}',
                                'name': '{{ product.name }}',
                                'variant': '{{ product.variant }}',
                                'brand': '{{ product.brand }}',
                                'dimension10': '{{ product.dimension10 }}',
                                'quantity': 1,
                                'price': '{{ product.price }}'
                            }{% if loop.last != true %},{% endif %}
                            {% endfor %}
                        ]
                    }
                }
            };

            var datalayerGA4 = {
                event: "add_to_cart",
                ecommerce: {
                    items: [
                        {% for product in enhancedEcommerce.ecommerce.add.products %}
                        {
                            item_name: '{{ product.name }}',
                            item_id: '{{ product.id }}',
                            price: '{{ product.price }}',
                            item_brand: '{{ product.brand }}',
                            item_variant: '{{ product.variant }}',
                            quantity: 1
                        }{% if loop.last != true %},{% endif %}
                        {% endfor %}
                    ]
                }
            };

            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push(datalayer);
            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push(datalayerGA4);

            document.getElementById("{{ enhancedEcommerce.addToCartFormId }}").submit();
        });
    }
});
{% endif %}
